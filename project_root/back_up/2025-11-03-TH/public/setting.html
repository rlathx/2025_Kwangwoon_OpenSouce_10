<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í…Œë§ˆ ì¼ê¸° - ì„¤ì •</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>ğŸ“” í…Œë§ˆ ì¼ê¸°</h1>
            <nav>
                <a href="index.html">ë©”ì¸</a>
                <a href="diary.html">ì¼ê¸° ì“°ê¸°</a>
                <a href="setting.html" class="active">ì„¤ì •</a>
            </nav>
        </header>

        <main>
            <section class="settings-section">
                <h2>âš™ï¸ ì„¤ì •</h2>

                <!-- ì§ˆë¬¸ ìœ í˜• ì„ íƒ -->
                <div class="setting-group">
                    <h3>ğŸ“ ì˜¤ëŠ˜ì˜ ì§ˆë¬¸ ì„¤ì •</h3>
                    <p class="description">ì¼ê¸°ë¥¼ ì“¸ ë•Œ ë³´ì—¬ì§ˆ ì§ˆë¬¸ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.</p>

                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="questionType" value="basic" onchange="updateQuestionType()">
                            <span>ê¸°ë³¸ ì§ˆë¬¸ (ë¯¸ë¦¬ ì œê³µëœ 10ê°œ ì§ˆë¬¸)</span>
                        </label>

                        <label class="radio-label">
                            <input type="radio" name="questionType" value="mbti" onchange="updateQuestionType()">
                            <span>MBTI ë§ì¶¤ ì§ˆë¬¸</span>
                        </label>

                        <label class="radio-label">
                            <input type="radio" name="questionType" value="custom" onchange="updateQuestionType()">
                            <span>ì‚¬ìš©ì ì •ì˜ ì§ˆë¬¸</span>
                        </label>
                    </div>

                    <!-- MBTI ì„ íƒ (mbti ì§ˆë¬¸ ì„ íƒ ì‹œì—ë§Œ í‘œì‹œ) -->
                    <div id="mbtiSelector" class="sub-setting" style="display: none;">
                        <label for="mbtiSelect">MBTI ìœ í˜• ì„ íƒ:</label>
                        <select id="mbtiSelect" onchange="saveSettings()">
                            <option value="ISTJ">ISTJ - ì„¸ìƒì˜ ì†Œê¸ˆí˜•</option>
                            <option value="ISFJ">ISFJ - ì„ê¸ˆ ë’¤í¸ì˜ ê¶Œë ¥í˜•</option>
                            <option value="INFJ">INFJ - ì˜ˆì–¸ìí˜•</option>
                            <option value="INTJ">INTJ - ê³¼í•™ìí˜•</option>
                            <option value="ISTP">ISTP - ë°±ê³¼ì‚¬ì „í˜•</option>
                            <option value="ISFP">ISFP - ì„±ì¸êµ°ìí˜•</option>
                            <option value="INFP">INFP - ì”ë‹¤ë¥´í¬í˜•</option>
                            <option value="INTP">INTP - ì•„ì´ë””ì–´ ë±…í¬í˜•</option>
                            <option value="ESTP">ESTP - ìˆ˜ì™„ì¢‹ì€ í™œë™ê°€í˜•</option>
                            <option value="ESFP">ESFP - ì‚¬êµì ì¸ ìœ í˜•</option>
                            <option value="ENFP">ENFP - ìŠ¤íŒŒí¬í˜•</option>
                            <option value="ENTP">ENTP - ë°œëª…ê°€í˜•</option>
                            <option value="ESTJ">ESTJ - ì‚¬ì—…ê°€í˜•</option>
                            <option value="ESFJ">ESFJ - ì¹œì„ ë„ëª¨í˜•</option>
                            <option value="ENFJ">ENFJ - ì–¸ë³€ëŠ¥ìˆ™í˜•</option>
                            <option value="ENTJ">ENTJ - ì§€ë„ìí˜•</option>
                        </select>
                    </div>
                </div>

                <!-- ì‚¬ìš©ì ì •ì˜ ì§ˆë¬¸ ê´€ë¦¬ -->
                <div class="setting-group">
                    <h3>â• ë‚˜ë§Œì˜ ì§ˆë¬¸ ì¶”ê°€</h3>
                    <p class="description">ì¼ê¸°ì—ì„œ ì‚¬ìš©í•  ì§ˆë¬¸ì„ ì§ì ‘ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

                    <div class="add-question-form">
                        <input type="text" id="newQuestionInput" placeholder="ìƒˆë¡œìš´ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”"
                            onkeypress="if(event.key === 'Enter') addCustomQuestion()">
                        <button class="btn btn-primary" onclick="addCustomQuestion()">ì¶”ê°€</button>
                    </div>

                    <div id="customQuestionsList" class="custom-questions-list">
                        <!-- ì‚¬ìš©ì ì •ì˜ ì§ˆë¬¸ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>

                <!-- í•œ ë§ˆë”” ìœ í˜• ì„ íƒ -->
                <div class="setting-group">
                    <h3>ğŸ’¬ ì˜¤ëŠ˜ì˜ í•œ ë§ˆë”” ì„¤ì •</h3>
                    <p class="description">ë©”ì¸ í˜ì´ì§€ì™€ ì¼ê¸° ì‘ì„± ì‹œ ë³´ì—¬ì§ˆ í•œ ë§ˆë”” ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.</p>

                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="messageType" value="mbti" onchange="updateMessageType()">
                            <span>MBTI ë§ì¶¤ í•œ ë§ˆë””</span>
                        </label>

                        <label class="radio-label">
                            <input type="radio" name="messageType" value="quote" onchange="updateMessageType()">
                            <span>ëª…ì–¸</span>
                        </label>
                    </div>

                    <!-- MBTI ì„ íƒ (mbti í•œë§ˆë”” ì„ íƒ ì‹œì—ë§Œ í‘œì‹œ) -->
                    <div id="mbtiMessageSelector" class="sub-setting" style="display: none;">
                        <label for="mbtiMessageSelect">MBTI ìœ í˜• ì„ íƒ:</label>
                        <select id="mbtiMessageSelect" onchange="saveSettings()">
                            <option value="ISTJ">ISTJ - ì„¸ìƒì˜ ì†Œê¸ˆí˜•</option>
                            <option value="ISFJ">ISFJ - ì„ê¸ˆ ë’¤í¸ì˜ ê¶Œë ¥í˜•</option>
                            <option value="INFJ">INFJ - ì˜ˆì–¸ìí˜•</option>
                            <option value="INTJ">INTJ - ê³¼í•™ìí˜•</option>
                            <option value="ISTP">ISTP - ë°±ê³¼ì‚¬ì „í˜•</option>
                            <option value="ISFP">ISFP - ì„±ì¸êµ°ìí˜•</option>
                            <option value="INFP">INFP - ì”ë‹¤ë¥´í¬í˜•</option>
                            <option value="INTP">INTP - ì•„ì´ë””ì–´ ë±…í¬í˜•</option>
                            <option value="ESTP">ESTP - ìˆ˜ì™„ì¢‹ì€ í™œë™ê°€í˜•</option>
                            <option value="ESFP">ESFP - ì‚¬êµì ì¸ ìœ í˜•</option>
                            <option value="ENFP">ENFP - ìŠ¤íŒŒí¬í˜•</option>
                            <option value="ENTP">ENTP - ë°œëª…ê°€í˜•</option>
                            <option value="ESTJ">ESTJ - ì‚¬ì—…ê°€í˜•</option>
                            <option value="ESFJ">ESFJ - ì¹œì„ ë„ëª¨í˜•</option>
                            <option value="ENFJ">ENFJ - ì–¸ë³€ëŠ¥ìˆ™í˜•</option>
                            <option value="ENTJ">ENTJ - ì§€ë„ìí˜•</option>
                        </select>
                    </div>
                </div>

                <!-- ì €ì¥ ë²„íŠ¼ -->
                <div class="button-group">
                    <button class="btn btn-success" onclick="saveSettings()">ğŸ’¾ ì„¤ì • ì €ì¥</button>
                </div>
            </section>
        </main>
    </div>

    <script>
        let currentSettings = {};
        let customQuestions = [];

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = async () => {
            await loadSettings();
            await loadCustomQuestions();
            renderCustomQuestions();
        };

        // ì„¤ì • ë¡œë“œ
        async function loadSettings() {
            try {
                const response = await fetch('/api/settings');
                currentSettings = await response.json();

                // ë¼ë””ì˜¤ ë²„íŠ¼ ì„¤ì •
                document.querySelector(`input[name="questionType"][value="${currentSettings.questionType}"]`).checked = true;
                document.querySelector(`input[name="messageType"][value="${currentSettings.messageType}"]`).checked = true;

                // MBTI ì„ íƒ ì„¤ì •
                document.getElementById('mbtiSelect').value = currentSettings.selectedMBTI;
                document.getElementById('mbtiMessageSelect').value = currentSettings.selectedMBTI;

                // ì¡°ê±´ë¶€ í‘œì‹œ
                updateQuestionType();
                updateMessageType();
            } catch (error) {
                console.error('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ì‚¬ìš©ì ì •ì˜ ì§ˆë¬¸ ë¡œë“œ
        async function loadCustomQuestions() {
            try {
                const response = await fetch('/api/questions');
                const data = await response.json();
                customQuestions = data.custom || [];
            } catch (error) {
                console.error('ì§ˆë¬¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                customQuestions = [];
            }
        }

        // ì§ˆë¬¸ ìœ í˜• ë³€ê²½ ì‹œ
        function updateQuestionType() {
            const questionType = document.querySelector('input[name="questionType"]:checked').value;
            const mbtiSelector = document.getElementById('mbtiSelector');

            if (questionType === 'mbti') {
                mbtiSelector.style.display = 'block';
            } else {
                mbtiSelector.style.display = 'none';
            }

            saveSettings();
        }

        // ë©”ì‹œì§€ ìœ í˜• ë³€ê²½ ì‹œ
        function updateMessageType() {
            const messageType = document.querySelector('input[name="messageType"]:checked').value;
            const mbtiMessageSelector = document.getElementById('mbtiMessageSelector');

            if (messageType === 'mbti') {
                mbtiMessageSelector.style.display = 'block';
            } else {
                mbtiMessageSelector.style.display = 'none';
            }

            saveSettings();
        }

        // ì„¤ì • ì €ì¥
        async function saveSettings() {
            const questionType = document.querySelector('input[name="questionType"]:checked').value;
            const messageType = document.querySelector('input[name="messageType"]:checked').value;
            const selectedMBTI = document.getElementById('mbtiSelect').value;

            const settings = {
                questionType: questionType,
                messageType: messageType,
                selectedMBTI: selectedMBTI
            };

            try {
                const response = await fetch('/api/settings', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });

                if (response.ok) {
                    console.log('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', error);
                alert('ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì‚¬ìš©ì ì •ì˜ ì§ˆë¬¸ ì¶”ê°€
        async function addCustomQuestion() {
            const input = document.getElementById('newQuestionInput');
            const question = input.value.trim();

            if (!question) {
                alert('ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            try {
                const response = await fetch('/api/questions/custom', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ question: question })
                });

                if (response.ok) {
                    input.value = '';
                    await loadCustomQuestions();
                    renderCustomQuestions();
                    alert('ì§ˆë¬¸ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! âœ…');
                } else {
                    alert('ì§ˆë¬¸ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì§ˆë¬¸ ì¶”ê°€ ì‹¤íŒ¨:', error);
                alert('ì§ˆë¬¸ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì‚¬ìš©ì ì •ì˜ ì§ˆë¬¸ ì‚­ì œ
        async function deleteCustomQuestion(index) {
            if (!confirm('ì´ ì§ˆë¬¸ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                const response = await fetch(`/api/questions/custom/${index}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    await loadCustomQuestions();
                    renderCustomQuestions();
                    alert('ì§ˆë¬¸ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    alert('ì§ˆë¬¸ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì§ˆë¬¸ ì‚­ì œ ì‹¤íŒ¨:', error);
                alert('ì§ˆë¬¸ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì‚¬ìš©ì ì •ì˜ ì§ˆë¬¸ ë Œë”ë§
        function renderCustomQuestions() {
            const listDiv = document.getElementById('customQuestionsList');

            if (customQuestions.length === 0) {
                listDiv.innerHTML = '<p class="empty-message">ì•„ì§ ì¶”ê°€ëœ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            listDiv.innerHTML = customQuestions.map((question, index) => `
                <div class="question-item">
                    <span class="question-text">${question}</span>
                    <button class="btn btn-delete" onclick="deleteCustomQuestion(${index})">ğŸ—‘ï¸ ì‚­ì œ</button>
                </div>
            `).join('');
        }
    </script>
</body>

</html>