<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Memory Archive | Calendar</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link rel="stylesheet" href="index_style.css" />
</head>

<body>
    <!-- í—¤ë” -->
    <header class="topbar">
        <div class="wrap d-flex align-items-center justify-content-between">
            <div class="brand"><i class="bi bi-journal-bookmark"></i> Memory Archive</div>

            <div class="d-flex align-items-center gap-2">
                <span id="mbtiBadge" class="badge rounded-pill mbti-badge">MBTI: ë¯¸ì„¤ì •</span>
                <a href="option.html" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-gear"></i> ì„¤ì •
                </a>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ -->
    <main class="wrap">
        <!-- ë‹¬ë ¥ -->
        <section class="calendar-shell">
            <div class="cal-header">
                <div class="cal-title">
                    <h1 id="monthTitle">YYYYë…„ Mì›”</h1>
                    <span class="badge rounded-pill">Calendar</span>
                </div>

                <!-- ì´ì „ë‹¬/ë‹¤ìŒë‹¬ -->
                <div class="month-nav d-flex align-items-center gap-2">
                    <button class="btn btn-outline-secondary btn-sm" id="btnPrev">
                        <i class="bi bi-chevron-left"></i> ì´ì „ë‹¬
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" id="btnToday">ì˜¤ëŠ˜</button>
                    <button class="btn btn-outline-secondary btn-sm" id="btnNext">
                        ë‹¤ìŒë‹¬ <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
            </div>

            <div class="weekdays">
                <div>Sun</div>
                <div>Mon</div>
                <div>Tue</div>
                <div>Wed</div>
                <div>Thu</div>
                <div>Fri</div>
                <div>Sat</div>
            </div>

            <!-- ë™ì ìœ¼ë¡œ ì±„ìš¸ ê·¸ë¦¬ë“œ -->
            <div class="grid" id="calendarGrid"></div>
        </section>

        <!-- ì˜¤ëŠ˜ì˜ í•œë§ˆë”” + ê°ì • ê·¸ë˜í”„ -->
        <aside class="quote-box">
            <h2>ì˜¤ëŠ˜ì˜ í•œë§ˆë”” ğŸ’¬</h2>
            <div class="quote-text">â€œì‘ì€ ë°œê±¸ìŒì´ë¼ë„ ë§¤ì¼ ë‚˜ì•„ê°€ë©´<br>ê²°êµ­ í° ê¸¸ì„ ì™„ì„±í•˜ê²Œ ëœë‹¤.â€</div>
            <div class="divider"></div>

            <div class="mood-card">
                <div class="mood-title">ê°ì • ê·¸ë˜í”„ <span class="text-muted" style="font-weight:400">(ì´ë²ˆ ì£¼)</span></div>
                <div class="mood-legend">
                    <span class="pill">ì•„ì£¼ ì¢‹ìŒ</span><span class="pill">ì¢‹ìŒ</span>
                    <span class="pill">ë³´í†µ</span><span class="pill">ì‚´ì§ ë‹¤ìš´</span><span class="pill">ìš°ìš¸</span>
                </div>

                <div class="mood-graph-wrap">
                    <div class="mood-scale-vertical"><span>ë†’ìŒ</span><span>ë‚®ìŒ</span></div>
                    <div class="mood-graph">
                        <div class="bar" style="--v:80" data-label="Sun"></div>
                        <div class="bar" style="--v:65" data-label="Mon"></div>
                        <div class="bar" style="--v:50" data-label="Tue"></div>
                        <div class="bar" style="--v:70" data-label="Wed"></div>
                        <div class="bar" style="--v:40" data-label="Thu"></div>
                        <div class="bar" style="--v:85" data-label="Fri"></div>
                        <div class="bar" style="--v:60" data-label="Sat"></div>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <script>
        // ====== ìƒíƒœ ======
        let view = new Date();                         // ìˆ˜ì • : ìƒíƒœ ë³€ìˆ˜ êµ¬ì¡° ë³€ê²½ (ê¸°ì¡´ currentYear/currentMonth â†’ Date ê°ì²´ ê¸°ë°˜ viewë¡œ ë‹¨ìˆœí™”)
        let viewYear = view.getFullYear();             // ìˆ˜ì • : currentYear ëŒ€ì‹  viewYear ì‚¬ìš©
        let viewMonth = view.getMonth();               // ìˆ˜ì • : currentMonth ëŒ€ì‹  viewMonth ì‚¬ìš©
        // ìˆ˜ì • : diariesData(ì„œë²„ ë°ì´í„°) ì‚¬ìš© ì œê±° â†’ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ê¸°ë°˜ìœ¼ë¡œ ì „í™˜

        // ë¸Œë¼ìš°ì €ê°€ DOMì„ ë‹¤ ì½ì€ ë’¤ ì‹¤í–‰ (window.onload â†’ DOMContentLoaded)
        window.addEventListener('DOMContentLoaded', () => {   // ìˆ˜ì • : window.onload(ì´ë¯¸ì§€/ë¦¬ì†ŒìŠ¤ê¹Œì§€ ëŒ€ê¸°) â†’ DOMContentLoaded(êµ¬ì¡°ë§Œ ì¤€ë¹„ë˜ë©´ ì‹¤í–‰)ë¡œ ë³€ê²½
            renderCalendar();                                  // ìˆ˜ì • : ì´ˆê¸°í™” ì‹œ ì„œë²„ í˜¸ì¶œ(loadTodayMessage/loadDiaries) ì œê±°, ë°”ë¡œ ë‹¬ë ¥ ë Œë”ë§Œ ìˆ˜í–‰

            // ì´ì „ë‹¬
            document.getElementById('btnPrev').addEventListener('click', () => {
                if (viewMonth === 0) { viewMonth = 11; viewYear--; }
                else viewMonth--;
                renderCalendar();
            });                                               // ìˆ˜ì • : changeMonth(delta) í•¨ìˆ˜ ì‚¬ìš© ì œê±°, ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆì—ì„œ ì§ì ‘ ì›”/ë…„ ê°±ì‹ 

            // ë‹¤ìŒë‹¬
            document.getElementById('btnNext').addEventListener('click', () => {
                if (viewMonth === 11) { viewMonth = 0; viewYear++; }
                else viewMonth++;
                renderCalendar();
            });                                               // ìˆ˜ì • : ë™ì¼í•˜ê²Œ changeMonth ì œê±° ë¡œì§

            // ì˜¤ëŠ˜ ë²„íŠ¼
            document.getElementById('btnToday').addEventListener('click', () => {
                const t = new Date();
                viewYear = t.getFullYear();
                viewMonth = t.getMonth();
                renderCalendar();
            });                                               // ìˆ˜ì • : ì˜¤ëŠ˜ ì´ë™ ë¡œì§ ë‹¨ìˆœí™” (ë³„ë„ ì „ì—­ today ìƒíƒœ ì—†ì´ ì¦‰ì‹œ ê³„ì‚°)
        });

        // ====== ìœ í‹¸ ======
        function toISO(y, m, d) {                              // ìˆ˜ì • : ë‚ ì§œ í¬ë§· ìœ í‹¸ ì‹ ê·œ ì¶”ê°€ (YYYY-MM-DD ê³ ì • í¬ë§·)
            const mm = String(m).padStart(2, '0');
            const dd = String(d).padStart(2, '0');
            return `${y}-${mm}-${dd}`;
        }

        // ====== ë Œë”ë§ ======
        function renderCalendar() {                             // ìˆ˜ì • : í•µì‹¬ ë Œë” í•¨ìˆ˜ ì¬êµ¬ì„± (ì„œë²„ ë°ì´í„°/ëª¨ë‹¬ ì˜ì¡´ ì œê±°)
            const grid = document.getElementById('calendarGrid');
            const title = document.getElementById('monthTitle'); // ìˆ˜ì • : ì œëª© ìš”ì†Œ id ë³€ê²½ (currentMonth â†’ monthTitle)

            // ì œëª© ì—…ë°ì´íŠ¸
            title.textContent = `${viewYear}ë…„ ${viewMonth + 1}ì›”`;

            // ì´ˆê¸°í™”
            grid.innerHTML = '';

            // ë‹¬ë ¥ ì •ë³´ ê³„ì‚°
            const first = new Date(viewYear, viewMonth, 1);
            const last = new Date(viewYear, viewMonth + 1, 0);
            const firstDay = first.getDay();
            const daysInMonth = last.getDate();

            // ì´ì „ë‹¬ ì—¬ë°± ì±„ìš°ê¸°
            for (let i = 0; i < firstDay; i++) {
                const div = document.createElement('div');
                div.className = 'cell muted';                   // ìˆ˜ì • : ë¹ˆì¹¸ í´ë˜ìŠ¤ ë³€ê²½ (empty â†’ cell muted)
                grid.appendChild(div);
            }

            // ë‚ ì§œ ì±„ìš°ê¸°
            const todayIso = new Date().toISOString().slice(0, 10); // ìˆ˜ì • : ì˜¤ëŠ˜ ë¹„êµê°’ ìƒì„± ë°©ì‹ ë³€ê²½ (Date ì¡°ë¦½ â†’ ISO ìŠ¬ë¼ì´ìŠ¤)
            for (let d = 1; d <= daysInMonth; d++) {
                const dateStr = toISO(viewYear, viewMonth + 1, d);  // ìˆ˜ì • : ë‚ ì§œ í‚¤ ìƒì„± ë°©ì‹ ë³€ê²½ (ë¬¸ìì—´ ì¡°í•© â†’ toISO ìœ í‹¸)
                const cell = document.createElement('div');
                cell.className = 'cell';                            // ìˆ˜ì • : ì…€ í´ë˜ìŠ¤ ë„¤ì´ë° ë³€ê²½ (calendar-day â†’ cell)
                cell.setAttribute('data-date', dateStr);

                const num = document.createElement('div');
                num.className = 'date-num';                         // ìˆ˜ì • : ìˆ«ì í´ë˜ìŠ¤ ë³€ê²½ (date-number â†’ date-num)
                num.textContent = String(d);
                cell.appendChild(num);

                // ì˜¤ëŠ˜ ì¹¸ ê°•ì¡° 
                if (dateStr === todayIso) {                         // ìˆ˜ì • : today íŒë³„ ë¡œì§ ìœ ì§€í•˜ë˜
                    cell.classList.add('today');                    // ìˆ˜ì • : ì¸ë¼ì¸ ë°°ê²½/ìƒ‰ìƒ ì§€ì • â†’ CSS í´ë˜ìŠ¤ todayë¡œ ì¼ì›í™”
                }

                // ê¸°ë¶„ ì´ëª¨ì§€ ë¶ˆëŸ¬ì˜¤ê¸°
                const emo = localStorage.getItem(`ma_mood_${dateStr}`); // ìˆ˜ì • : ì„œë²„ diariesData ëŒ€ì‹  localStorage í‚¤(ma_mood_YYYY-MM-DD)ì—ì„œ ì´ëª¨ì§€ ë¡œë“œ
                if (emo) {
                    const badge = document.createElement('span');
                    badge.className = 'mood-emoji';                 // ìˆ˜ì • : ì´ëª¨ì§€ ë±ƒì§€ í´ë˜ìŠ¤ ìœ ì§€(ë Œë” êµ¬ì¡°ë§Œ ë‹¨ìˆœí™”)
                    badge.textContent = emo;
                    cell.appendChild(badge);
                    cell.classList.add('has-emoji');                // ìˆ˜ì • : ì´ëª¨ì§€ ìˆì„ ë•Œ ì—¬ë°±/ë ˆì´ì•„ì›ƒ ë³´ì •ìš© í´ë˜ìŠ¤ ì¶”ê°€
                }

                // ë”ë¸”í´ë¦­ ì‹œ diary.html ì´ë™
                attachDoubleClick(cell, dateStr);                   // ìˆ˜ì • : ë‹¨ì¼ í´ë¦­ ëª¨ë‹¬(viewDiary) â†’ ë”ë¸”í´ë¦­ í˜ì´ì§€ ì´ë™(diary.html?date=...)ë¡œ UX ë³€ê²½

                grid.appendChild(cell);
            }

            // ë‹¤ìŒë‹¬ ë¹ˆì¹¸ ì±„ìš°ê¸°
            const totalCells = firstDay + daysInMonth;
            const tail = (7 - (totalCells % 7)) % 7;
            for (let i = 0; i < tail; i++) {
                const div = document.createElement('div');
                div.className = 'cell muted';                       // ìˆ˜ì • : ë™ì¼í•˜ê²Œ ë¹ˆì¹¸ í´ë˜ìŠ¤(cell muted) ì‚¬ìš©
                grid.appendChild(div);
            }
        }

        // ë”ë¸”í´ë¦­ ìœ í‹¸ í•¨ìˆ˜
        function attachDoubleClick(cell, dateStr) {                 // ìˆ˜ì • : ë”ë¸”í´ë¦­ ê°ì§€ ìœ í‹¸ ì‹ ê·œ ì¶”ê°€ (ë‹¨ì¼ í´ë¦­ ëª¨ë‹¬ ë¡œì§ ì œê±° ëŒ€ì²´)
            let clicks = 0, timer = null;
            cell.addEventListener('click', () => {
                clicks++;
                if (clicks === 2) {
                    clearTimeout(timer);
                    window.location.href = `diary.html?date=${dateStr}`; // ìˆ˜ì • : ëª¨ë‹¬ ì˜¤í”ˆ(viewDiary) â†’ í˜ì´ì§€ ì´ë™
                } else {
                    timer = setTimeout(() => { clicks = 0; }, 500);
                }
            });
        }

        // -------------------------------
        // ì°¸ê³  : ì•„ë˜ ê¸°ëŠ¥ë“¤ì€ ì œê±°/ëŒ€ì²´ë¨
        // - loadTodayMessage() / loadDiaries() : ì„œë²„ API(fetch) ì˜ì¡´ ì œê±°
        // - diariesData / getWeatherColor() / getWeatherEmoji() : ë‚ ì”¨ìƒ‰/ì´ëª¨ì§€ í‘œì‹œ ì œê±°
        // - viewDiary(), closeModal(), window.onclick : ëª¨ë‹¬ ê¸°ë°˜ ë·° ì œê±°
        // - changeMonth(delta) : ì›” ë³€ê²½ í—¬í¼ ì œê±°, ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆì—ì„œ ì§ì ‘ ì²˜ë¦¬
        // - ìš”ì¼ í—¤ë” ìƒì„± : JSë¡œ ìƒì„±í•˜ë˜ ë¶€ë¶„ ì‚­ì œ(HTMLì—ì„œ ì´ë¯¸ ì£¼ê°„ í—¤ë”ë¥¼ ë Œë”)
        // -------------------------------
    </script>


</body>

</html>
